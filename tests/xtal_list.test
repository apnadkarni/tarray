# xtal list operation tests

source testutil.tcl

namespace eval tarray::test::xtal_list {
    namespace path ::tarray::test
    set L {zero one two three}
    test xtal-list-index-1.0 {Literal list scalar index} -body {
        xtal::xtal {
            {100, 200, 300, 400}[0]
        }
    } -result 100

    test xtal-list-index-1.1 {Literal list scalar index} -body {
        xtal::xtal {
            i = 2
            {100, 200, 300, 400}[i]
        }
    } -result 300

    test xtal-list-index-1.2 {Literal list scalar index} -body {
        xtal::xtal {
            {100, 200, 300, 400}[% @@ - 1]
        }
    } -result 400

    test xtal-list-index-2.0 {list variable scalar index} -body {
        xtal::xtal {L[0]}
    } -result zero

    test xtal-list-index-2.1 {list variable scalar index} -body {
        xtal::xtal {i = 1 ; L[i]}
    } -result one
    
    test xtal-list-index-2.2 {list variable scalar index} -body {
        xtal::xtal {L[%L-1]}
    } -result three

    test xtal-list-index-2.3 {list variable scalar index} -body {
        xtal::xtal {i = 2 ; L[%@@-i]}
    } -result two

    test xtal-list-index-3.0 {Literal list negative scalar index} -body {
        xtal::xtal {{100, 200, 300, 400}[- 1]}
    } -result "list index out of range" -returnCodes error
    
    test xtal-list-index-3.1 {Literal list out of bounds scalar index} -body {
        xtal::xtal {i = %L; L[i]}
    } -result "list index out of range" -returnCodes error
    
    test xtal-list-index-3.2 {Literal list non-integer scalar index} -body {
        xtal::xtal {i = "notanint"; L[i]}
    } -result "list index out of range" -returnCodes error

    test xtal-list-index-3.3 {Literal list non-integer scalar index} -body {
        xtal::xtal {i = 1.0; L[i]}
    } -result "bad index*" -match glob -returnCodes error

    #
    # Indexlists
    test xtal-list-indexlist-1.0 {Literal list indexlist} -body {
        xtal::xtal {
            {100, 200, 300, 400}[{0,2}]
        }
    } -result {100 300}

    test xtal-list-indexlist-1.1 {Literal list indexlist} -body {
        xtal::xtal {
            i = {3,0,1}
            {100, 200, 300, 400}[i]
        }
    } -result {400 100 200}
    
    test xtal-list-indexlist-1.2 {Literal list empty indexlist} -body {
        xtal::xtal {
            {100, 200, 300, 400}[{}]
        }
    } -result {}

    test xtal-list-indexlist-2.0 {list variable indexlist} -body {
        xtal::xtal {L[{0,3}]}
    } -result {zero three}

    test xtal-list-indexlist-2.1 {list variable indexlist} -body {
        xtal::xtal {i = {3,2,1,0} ; L[i]}
    } -result {three two one zero}
    
    test xtal-list-indexlist-2.2 {list variable indexlist} -body {
        xtal::xtal {i = {} ; L[i]}
    } -result {}

    test xtal-list-indexlist-2.3 {list variable indexlist} -body {
        xtal::xtal {
            I = {1,2,3,0}
            I[I]
        }
    } -result {2 3 0 1}

    test xtal-list-indexlist-3.0 {Literal list negative indexlist} -body {
        xtal::xtal {{100, 200, 300, 400}[{-1, 0}]}
    } -result "list index out of range" -returnCodes error
    
    test xtal-list-indexlist-3.1 {Literal list negative indexlist} -body {
        xtal::xtal {i = {0, %L}; L[i]}
    } -result "list index out of range" -returnCodes error
    
    #
    # Index columns
    test xtal-list-indexcolumn-1.0 {Literal list indexcolumn} -body {
        xtal::xtal {
            {100, 200, 300, 400}[@int {0,2}]
        }
    } -result {100 300}

    test xtal-list-indexcolumn-1.1 {Literal list indexcolumn} -body {
        xtal::xtal {
            i = @int {3,0,1}
            {100, 200, 300, 400}[i]
        }
    } -result {400 100 200}
    
    test xtal-list-indexcolumn-1.2 {Literal list empty indexcolumn} -body {
        xtal::xtal {
            {100, 200, 300, 400}[@int {}]
        }
    } -result {}

    test xtal-list-indexcolumn-2.0 {list variable indexcolumn} -body {
        xtal::xtal {L[@int {0,3}]}
    } -result {zero three}

    test xtal-list-indexcolumn-2.1 {list variable indexcolumn} -body {
        xtal::xtal {i = @int {3,2,1,0} ; L[i]}
    } -result {three two one zero}
    
    test xtal-list-indexcolumn-2.2 {list variable indexcolumn} -body {
        xtal::xtal {i = @int {} ; L[i]}
    } -result {}

    test xtal-list-indexcolumn-3.0 {Literal list negative indexcolumn} -body {
        xtal::xtal {{100, 200, 300, 400}[@int {-1, 0}]}
    } -result "list index out of range" -returnCodes error
    
    test xtal-list-indexcolumn-3.1 {Literal list negative indexcolumn} -body {
        xtal::xtal {i = @int {0, %L}; L[i]}
    } -result "list index out of range" -returnCodes error
}

::tcltest::cleanupTests
